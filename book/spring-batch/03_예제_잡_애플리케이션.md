# 예제 잡 애플리케이션  

- [학습 목표](#학습-목표)
- [Intro](#Intro)
- [애자일 개발 이해하기](#애자일-개발-이해하기)
  - [사용자 스토리로 요구사항 포착하기](#사용자-스토리로-요구사항-포착하기)
  - [테스트 주도 개발로 설계하기](#테스트-주도-개발로-설계하기)
- [은행 거래명세서 잡의 요구 사항 이해하기](#은행-거래명세서-잡의-요구-사항-이해하기)
- [배치 잡 설계하기](#배치-잡-설계하기)
- [데이터 모델 이해하기](#데이터-모델-이해하기)
---  

## 학습 목표

- 애자일 개발 프로세스에 대해 살펴본다.
- 은행 거래명세서 예제로 요구 사항을 이해한다.
- 데이터 모델에 대한 이해와 배치 잡을 설계한다.

---  

## Intro  

10장에서 실제 시나리오를 기반으로 하는 예제 애플리케이션을 만들 예정이다(단순화 했지만 배치를 사용해볼 만큼 충분히 복잡하다).  

**은행 거래명세서**란 예제로 여러 가지 주요 배치 개념을 살펴볼 것이다.  

- **다양한 입력 및 출력 방식**
  - 스프링 배치에서 가장 중요한 기능 중 하나로, 다양한 Source를 대상으로 데이터 입/출력을 처리하는 잘 추상화된 기능이 있다.
  - 예제) 입력: Flat file, Database / 출력: Flat file, Database 
- **오류 처리**  
  - 배치 처리의 유지 보수 중 최악의 상황은 처리 중 오류가 발생해 이를 해결하는 것이다. 그러므로 강력한 오류 처리 능력은 필수적이다.
  - 예제) 로깅, 오류가 있는 레코드 건너뛰기, 재시도 등
- **확장성**
  - 배치 처리는 많은 양의 데이터를 처리할 수 있어야한다. (후반부에 배치 처리 튜닝에 대해 다룬다)

---  

## 애자일 개발 이해하기  

이 책에서 사용할 애자일과 개발 프로세스의 개념을 확립하는 일부터 시작해보자.  

**:white_check_mark: 애자일의 12가지 테넌트**  

- 고객 만족은 동작하는 소프트웨어를 고객에게 빠르게 전달함으로써 얻어진다.
- 개발 단계에 관계없이 변경을 환영하라.
- 동작하는 소프트웨어를 자주 배포하라.
- 비즈니스 담당자와 개발자는 매일 함께 일해야 한다.
- 동기가 부여된 구성원으로 프로젝트를 구성하라. 구성원에게 필요한 도구를 제공하고 작업을 완수할 것이라고 믿어라.
- 얼굴을 맞대고 이루어지는 의사 교환이 가장 효과적이다.
- 동작하는 소프트웨어가 진척도의 가장 중요한 척도다.
- 지속 가능한 개발을 장려하라. 팀원 전원이 개발 속도를 꾸준하게 유지할 수 있어야한다.
- 우수한 기술력과 좋은 설계 능력을 갖추도록 지속적으로 노력하라.
- 불필요한 작업을 없애 낭비를 최소화하라
- 자기 조직화(Self-organizing)된 팀이 최고의 요구 사항, 아키텍처, 설계를 만들어낸다.
- 팀은 정기적으로 어떻게 개선할지 결정하고 이를 반영한다.

### 사용자 스토리로 요구사항 포착하기

사용자 스토리(User Story)는 요구 사항을 문서화하는 애자일 방법이다.  

사용자 스토리에는 세 가지 주요 부분이 있다.

- **제목(title)**  
  - 스토리의 내용과 관련된 단순하고 간결한 설명이어야 한다.(GUI로 한정되지 않음)
    - e.g) "거래 파일 내 정보를 적재한다", "인쇄 파일을 생성한다"
- **내러티브(narrative)**  
  - 사용자 스토리로 문서화하려는 상호작용을 사용자 관점에서 간단히 설명한 것이다.
    - e.g) "Y 상황에서, X가 무언가를 수행하고 어떤 다른 일이 발생한다"
- **인수 기준(acceptance criteria)**
  - 스토리의 완료 여부를 판단하는 데 사용할 수 있는 테스트 가능한 요구 사항이다. (객관적인 항목)


> 사용자 스토리 예제) 범용 리모컨

```text
- 제목: 텔리비전 켜기
- 내러티브: 사용자는 텔레비전, 수신기, 케이블 박스를 끈 상태에서 범용 리모컨의 전원 버튼을 누를 수 있다.
          그러면 리모컨은 텔레비전, 수신기, 케이블 박스의 전원을 켜고 텔레비전 쇼를 보도록 구성한다.
- 인수 기준
  - 범용 리모컨에는 전원 버튼이 있다.
  - 사용자가 전원 버튼을 누르면 다음과 같이 동작한다.
    1. 텔레비전 저누언이 켜진다.
    2. AV 수신기 전원이 켜진다.
    3. 케이블 박스 전원이 켜진다.
    4. 케이블 박스는 187 채널로 설정될 것이다.
    5. AV 수신기는 SAT 입력으로 설정될 것이다.
    6. TV 비디오 1 입력으로 설정될 것이다.          
```

<details>
<summary>사용자 스토리(User Story) VS 유스케이스(USE CASE)</summary>
유스케이스는 또 다른 요구 사항 문서이며 사용자 스토리와 유사하게 Actor 중심적이다.  
유스케이스는 RUP(Rational Unified Process)의 문서화 양식으로 행위자와 시스템 간의 상호작용의 모든 측면을 문서화할 때 사용한다.
</details>

### 테스트 주도 개발로 설계하기  

테스트 주도 개발(TDD, Test-Driven Development)은 또 다른 애자일 실천 방식이다.  

- 실패 테스트 작성 -> 코드 구현 -> 테스트 성공하는 사이클을 가진다.
- 코드를 작성하기 전에 무엇을 코드화 하려고 하는지 생각하도록 설계되었다.
- (지속적인 코드 유지 보수 활동 중 하나로써)테스트가 실행 가능한 문서가 된다.  

----

## 은행 거래명세서 잡의 요구 사항 이해하기  

----  

## 배치 잡 설계하기  

### 잡의 처리 흐름  

![은행 거래명세서 잡 흐름](https://user-images.githubusercontent.com/25560203/130450191-97a9d9e4-b464-4360-9a24-30634e771453.png)  

**고객 데이터 가져오기**  

입력 데이터는 3가지 종류의 레코드 유형으로 구성된 Flat file(csv)이다. ItemProcessor를 통해 유효성을 검증하고 적절한 ItemWriter 구현체를 사용해  
레코드 유형에 따라 적절하게 데이터를 갱신한다.

<details>
<summary>고객 입력 파일</summary>

```text
2,5,,,Montgomery,Alabama,36134
3,5,,,,316-510-9138,2
1,5,Rozelle,Heda,Farnill
```
</details>  

**거래 정보 데이터 가져오기**  

고객 데이터를 가져온 후 거래 데이터를 가져온다(XML을 읽은 뒤 데이터베이스에 기록한다).  

<details>
<summary>거래 정보 입력 파일</summary>

```xml
<?xml version='1.0' encoding='UTF-8'?>
<transactions>
	<transaction>
		<transactionId>2462744</transactionId>
		<accountId>405</accountId>
		<description>Skinix</description>
		<credit/>
		<debit>-438</debit>
		<timestamp>2018-06-01 19:39:53</timestamp>
	</transaction>
</transactions>
```
</details>  

**현재 잔액 계산하기**  

거래 데이터를 가져온 뒤 계좌 테이블의 잔액도 갱신한다. 드라이빙 쿼리 패턴으로 각 계좌 내 거래 내코드를 순서대로 가져와서  
해당 거래 레코드가 현재 잔액에 미치는 영향을 계산 후 잔액을 갱신한다.

**월별 고객 거래명세서 생성하기**  

고객의 거래명세서를 포함하는 인쇄 파일을 계좌당 하나씩 생성한다.  

- ItemReader: 데이터베이스에서 고객 데이터를 읽는다.
- ItemProcessor: 거래명세서 작성에 필요한 모든 데이터를 추가한다.
- ItemWriter: 거래 명세서 파일을 생성한다.

---  

## 데이터 모델 이해하기  

![예제 애플리케이션 데이터 모델](https://user-images.githubusercontent.com/25560203/130453536-964240d0-7796-4301-be59-1fdc85c7e751.png)  

- Customer: 고객 테이블(이름 및 연락처 정보 등 고객 정보가 포함)
- Account: 계좌 테이블(계좌 번호 및 현재 잔액)
- CustomerAccount: 고객-계좌 조인 테이블
- Transaction: 거래 정보 테이블


































---  